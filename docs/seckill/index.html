<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>秒杀架构 | 笔记</title>
    <meta name="description" content="世界上最大的谎言就是你不行">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/wliduo/Index@master/static/favicon.ico">
  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/wliduo/Index@master/static/count.js"></script>
    
    <link rel="preload" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/css/0.styles.f5885cf1.css" as="style"><link rel="preload" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/app.998d0eea.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/2.014606d6.js" as="script"><link rel="preload" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/52.ee610100.js" as="script"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/10.0a4d1b23.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/11.741b0e12.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/12.e434cf03.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/13.d758c8bd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/14.25989f2a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/15.bb1eec76.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/16.b3d7384f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/17.01190269.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/18.91c459b0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/19.caf943e9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/20.b281307b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/21.f10ad991.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/22.5cdd679c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/23.b1d2c003.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/24.b70caede.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/25.231cb7f4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/26.e3956cdd.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/27.28d324b4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/28.83343f0b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/29.8a52f99b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/3.189201b4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/30.de69ed2b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/31.db085299.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/32.4be61a78.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/33.0f405e72.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/34.1b4bcf1e.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/35.4fda4660.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/36.3dd911f0.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/37.2bf04fea.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/38.cbf8594f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/39.e57e06bf.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/4.4ad13904.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/40.5c54c17a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/41.65a24bb9.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/42.22084fb8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/43.b76257fc.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/44.33d00a8c.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/45.eda746e1.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/46.3ed63d49.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/47.32d8d7da.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/48.5e5caa40.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/49.9ca5449b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/5.743b8bae.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/50.0cf91fa5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/51.3bacb6ce.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/53.58db9ab4.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/54.2d59f08f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/55.fd6d960b.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/56.258f6a7a.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/57.0c673279.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/58.19ed3a39.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/59.eda6b1a2.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/6.924221b5.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/60.737d3a97.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/61.0c07ec23.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/62.08acc132.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/63.e75a62e8.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/7.240d3442.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/8.8ef3756f.js"><link rel="prefetch" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/9.e1a849bc.js">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/css/0.styles.f5885cf1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习记录" class="dropdown-title"><span class="title">学习记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/netty/" class="nav-link">Netty</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/cache/" class="nav-link">缓存</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/front/" class="nav-link">前端记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构记录" class="dropdown-title"><span class="title">架构记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/seckill/" class="nav-link router-link-exact-active router-link-active">秒杀架构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他补充" class="dropdown-title"><span class="title">其他补充</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/command/" class="nav-link">工具命令</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">零散记录</a></li><li class="dropdown-item"><!----> <a href="/gossip/" class="nav-link">编程闲话</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shirojwt/" class="nav-link">ShiroJwt</a></li><li class="dropdown-item"><!----> <a href="/seckill-evolution/" class="nav-link">SeckillEvolution</a></li><li class="dropdown-item"><!----> <a href="/viewgenerator/" class="nav-link">ViewGenerator</a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/VueStudy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VueStudy
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/NettyStudy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NettyStudy
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/Elasticsearch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Elasticsearch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">关于投食</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系" class="dropdown-title"><span class="title">联系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://map.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://blog.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://res.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  音乐
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://msg.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  留言
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://cv.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简历
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://github.com/dolyw" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="学习记录" class="dropdown-title"><span class="title">学习记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/netty/" class="nav-link">Netty</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">Docker</a></li><li class="dropdown-item"><!----> <a href="/elasticsearch/" class="nav-link">Elasticsearch</a></li><li class="dropdown-item"><!----> <a href="/cache/" class="nav-link">缓存</a></li><li class="dropdown-item"><!----> <a href="/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/front/" class="nav-link">前端记录</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="架构记录" class="dropdown-title"><span class="title">架构记录</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/seckill/" class="nav-link router-link-exact-active router-link-active">秒杀架构</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他补充" class="dropdown-title"><span class="title">其他补充</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/command/" class="nav-link">工具命令</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">零散记录</a></li><li class="dropdown-item"><!----> <a href="/gossip/" class="nav-link">编程闲话</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开源项目" class="dropdown-title"><span class="title">开源项目</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/shirojwt/" class="nav-link">ShiroJwt</a></li><li class="dropdown-item"><!----> <a href="/seckill-evolution/" class="nav-link">SeckillEvolution</a></li><li class="dropdown-item"><!----> <a href="/viewgenerator/" class="nav-link">ViewGenerator</a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/VueStudy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  VueStudy
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/NettyStudy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NettyStudy
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/dolyw/Elasticsearch" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Elasticsearch
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">关于投食</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系" class="dropdown-title"><span class="title">联系</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://map.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  导航
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://blog.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  博客
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://res.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  音乐
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://msg.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  留言
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://cv.dolyw.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  简历
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://dolyw.com/go?url=https://github.com/dolyw" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/seckill/" class="active sidebar-link">秒杀架构</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/seckill/#常见场景" class="sidebar-link">常见场景</a></li><li class="sidebar-sub-header"><a href="/seckill/#流量削峰" class="sidebar-link">流量削峰</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/seckill/#排队" class="sidebar-link">排队</a></li><li class="sidebar-sub-header"><a href="/seckill/#答题" class="sidebar-link">答题</a></li><li class="sidebar-sub-header"><a href="/seckill/#分层过滤" class="sidebar-link">分层过滤</a></li><li class="sidebar-sub-header"><a href="/seckill/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/seckill/#项目准备" class="sidebar-link">项目准备</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/seckill/#表结构" class="sidebar-link">表结构</a></li><li class="sidebar-sub-header"><a href="/seckill/#工程创建" class="sidebar-link">工程创建</a></li></ul></li><li class="sidebar-sub-header"><a href="/seckill/#思路流程" class="sidebar-link">思路流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/seckill/#传统方式" class="sidebar-link">传统方式</a></li><li class="sidebar-sub-header"><a href="/seckill/#使用乐观锁" class="sidebar-link">使用乐观锁</a></li><li class="sidebar-sub-header"><a href="/seckill/#使用缓存" class="sidebar-link">使用缓存</a></li><li class="sidebar-sub-header"><a href="/seckill/#使用分布式限流" class="sidebar-link">使用分布式限流</a></li><li class="sidebar-sub-header"><a href="/seckill/#使用队列异步下单" class="sidebar-link">使用队列异步下单</a></li></ul></li></ul></li><li><a href="/seckill/01-Tradition-Process.html" class="sidebar-link">传统方式</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="秒杀架构"><a href="#秒杀架构" class="header-anchor">#</a> 秒杀架构</h1> <p>秒杀是现在互联网常见的并发量巨大的场景，一直想自己写一个简单的秒杀架构的演变，加强自己，参考了很多博客和文章，如有不正确的地方请指出，感谢😋</p> <p><img src="https://img10.360buyimg.com/img/jfs/t27796/151/2205070659/340443/f4dbf4bd/5bfa9c1dN4d41b4a0.jpg" alt="图片"></p> <h2 id="常见场景"><a href="#常见场景" class="header-anchor">#</a> 常见场景</h2> <p>最典型的就是淘宝京东等电商双十一秒杀了，短时间上亿的用户涌入，瞬间流量巨大(高并发)，比如: 200万人准备在凌晨12:00准备抢购一件商品，但是商品的数量是有限的100件</p> <p>这样真实能购买到该件商品的用户也只有100人及以下，不能卖超，但是从业务上来说，秒杀活动是希望更多的人来参与，也就是抢购之前希望有越来越多的人来看购买商品，但是，在抢购时间达到后，用户开始真正下单时，秒杀的服务器后端却不希望同时有几百万人同时发起抢购请求</p> <p>我们都知道服务器的处理资源是有限的，所以出现峰值的时候，很容易导致服务器宕机，用户无法访问的情况出现</p> <p>这就好比出行的时候存在早高峰和晚高峰的问题，为了解决这个问题，出行就有了错峰限行的解决方案</p> <p>同理，在线上的秒杀等业务场景，也需要类似的解决方案，需要平安度过同时抢购带来的流量峰值的问题，这就是流量削峰的由来</p> <h2 id="流量削峰"><a href="#流量削峰" class="header-anchor">#</a> 流量削峰</h2> <p>削峰从本质上来说就是更多地延缓用户请求，以及层层过滤用户的访问需求，遵从<strong>最后落地到数据库的请求数要尽量少</strong>的原则</p> <p>流量削峰主要有三种操作思路，简单说下，详细可以查看: <a href="https://www.cnblogs.com/yanggb/p/11117400.html" target="_blank" rel="noopener noreferrer">流量削峰<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <ol><li><a href="#%E6%8E%92%E9%98%9F">排队</a></li> <li><a href="#%E7%AD%94%E9%A2%98">答题</a></li> <li><a href="#%E5%88%86%E5%B1%82%E8%BF%87%E6%BB%A4">分层过滤</a></li></ol> <h3 id="排队"><a href="#排队" class="header-anchor">#</a> 排队</h3> <p>排队最容易想到的解决方案就是用<strong>消息队列</strong>来缓冲瞬时流量，把同步的直接调用转换成异步的间接推送，中间通过一个队列在一端承接瞬时的流量洪峰，在另一端平滑地将消息推送出去</p> <p>在这里，<strong>消息队列</strong>就像<strong>水库</strong>一样，拦蓄上游的洪水，削减进入下游河道的洪峰流量，从而达到减免洪水灾害的目的</p> <h3 id="答题"><a href="#答题" class="header-anchor">#</a> 答题</h3> <p>答题目的其实就是延缓请求，起到对请求流量进行削峰的作用，从而让系统能够更好地支持瞬时的流量高峰</p> <h3 id="分层过滤"><a href="#分层过滤" class="header-anchor">#</a> 分层过滤</h3> <p>前面介绍的排队和答题，要么是在接收请求时做缓冲，要么是减少请求的同时发送，而针对秒杀场景还有一种方法，就是对请求进行分层过滤，从而过滤掉一些无效的请求，从Web层接到请求，到缓存，消息队列，最终到数据库这样就像漏斗一样，尽量把数据量和请求量一层一层地过滤和减少了</p> <ul><li>通过在不同的层次尽可能地过滤掉无效请求</li> <li>通过<strong>CDN</strong>过滤掉大量的图片，静态资源的请求</li> <li>再通过类似<strong>Redis</strong>这样的分布式缓存，过滤请求等就是典型的在上游拦截读请求</li></ul> <ul><li>对写数据进行基于时间的合理分片，过滤掉过期的失效请求</li> <li>对写请求做限流保护，将超出系统承载能力的请求过滤掉</li> <li>涉及到的读数据不做强一致性校验，减少因为一致性校验产生瓶颈的问题</li> <li>对写数据进行强一致性校验，只保留最后有效的数据</li></ul> <p>最终，到漏斗最末端(数据库)的才是有效请求。例如，当用户真实达到订单和支付的流程，这个是需要数据强一致性的</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ol><li>对于秒杀这样的高并发场景业务，最基本的原则就是将请求拦截在系统上游，降低下游压力。如果不在前端拦截很可能造成数据库读写锁冲突，甚至导致死锁，最终还有可能出现雪崩等场景</li> <li>划分好动静资源，静态资源使用<strong>CDN</strong>进行服务分发</li> <li>充分利用缓存，增加<strong>QPS</strong>，从而加大整个集群的吞吐量</li> <li>高峰值流量是压垮系统很重要的原因，所以需要消息队列在一端承接瞬时的流量洪峰，在另一端平滑地将消息推送出去</li></ol> <h2 id="项目准备"><a href="#项目准备" class="header-anchor">#</a> 项目准备</h2> <h3 id="表结构"><a href="#表结构" class="header-anchor">#</a> 表结构</h3> <p>这里我采用的是<strong>MySQL</strong>，简单的使用两个表，一个库存表，一个订单表，插入一条商品数据</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">--- 删除数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> seckill<span class="token punctuation">;</span>
<span class="token comment">--- 创建数据库</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> seckill<span class="token punctuation">;</span>
<span class="token comment">--- 使用数据库</span>
<span class="token keyword">use</span> seckill<span class="token punctuation">;</span>
<span class="token comment">--- 创建库存表</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>t_seckill_stock<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_seckill_stock<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'库存ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'OnePlus 7 Pro'</span> <span class="token keyword">COMMENT</span> <span class="token string">'名称'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>count<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'库存'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>sale<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'已售'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>version<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'乐观锁，版本号'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>update_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'更新时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'库存表'</span><span class="token punctuation">;</span>
<span class="token comment">--- 插入一条商品，初始化50个库存</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span>t_seckill_stock<span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>count<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>sale<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>version<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'50'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">--- 创建库存订单表</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> <span class="token punctuation">`</span>t_seckill_stock_order<span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>t_seckill_stock_order<span class="token punctuation">`</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>stock_id<span class="token punctuation">`</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'库存ID'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'OnePlus 7 Pro'</span> <span class="token keyword">COMMENT</span> <span class="token string">'商品名称'</span><span class="token punctuation">,</span>
  <span class="token punctuation">`</span>create_time<span class="token punctuation">`</span> <span class="token keyword">timestamp</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">'创建时间'</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COLLATE</span><span class="token operator">=</span>utf8mb4_bin <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">'库存订单表'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="工程创建"><a href="#工程创建" class="header-anchor">#</a> 工程创建</h3> <p>这个自行创建即可，我创建的是一个<strong>SpringBoot2</strong>项目，然后使用<strong>代码生成工具</strong>: <a href="https://github.com/dolyw/ViewGenerator" target="_blank" rel="noopener noreferrer">ViewGenerator<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，根据表结构生成一下对应的文件，记得移除表前缀参数<code>t_seckill_</code></p> <p><img src="https://cdn.jsdelivr.net/gh/wliduo/CDN@master/2019/11/20191120002.png" alt="图片"></p> <p>使用<strong>通用Mapper</strong>要在<strong>Application</strong>处加个注解<code>@tk.mybatis.spring.annotation.MapperScan</code></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@tk</span><span class="token punctuation">.</span>mybatis<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span><span class="token class-name">MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.example.dao&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p><strong>SpringBoot2</strong>连接<strong>MySQL</strong><code>url</code>属性要配置<strong>serverTimezone=GMT%2B8</strong>，<code>driver-class-name</code>属性要改为<strong>com.mysql.cj.jdbc.Driver</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> SeckillEvolution
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/seckill<span class="token punctuation">?</span>serverTimezone=GMT%2B8<span class="token important">&amp;useSSL</span>=false<span class="token important">&amp;useUnicode</span>=true<span class="token important">&amp;characterEncoding</span>=UTF<span class="token punctuation">-</span><span class="token number">8</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> root
        <span class="token comment"># 使用Druid数据源</span>
        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
        <span class="token key atrule">druid</span><span class="token punctuation">:</span>
            <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat
            <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
            <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
            <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
            <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> select 'x'
            <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">maxOpenPreparedStatements</span><span class="token punctuation">:</span> <span class="token number">20</span>
    <span class="token comment"># 404交给异常处理器处理</span>
    <span class="token key atrule">mvc</span><span class="token punctuation">:</span>
        <span class="token key atrule">throw-exception-if-no-handler-found</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token comment"># 404交给异常处理器处理</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span>
        <span class="token key atrule">add-mappings</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>

<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
    <span class="token comment"># Mybatis配置Mapper路径</span>
    <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/*.xml
    <span class="token comment"># Mybatis配置Model类对应</span>
    <span class="token key atrule">type-aliases-package</span><span class="token punctuation">:</span> com.example.dto.custom

<span class="token key atrule">pagehelper</span><span class="token punctuation">:</span>
    <span class="token key atrule">params</span><span class="token punctuation">:</span> count=countSql
    <span class="token comment"># 指定分页插件使用哪种方言</span>
    <span class="token key atrule">helper-dialect</span><span class="token punctuation">:</span> mysql
    <span class="token comment"># 分页合理化参数 pageNum&lt;=0时会查询第一页 pageNum&gt;pages(超过总数时) 会查询最后一页</span>
    <span class="token key atrule">reasonable</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
    <span class="token key atrule">support-methods-arguments</span><span class="token punctuation">:</span> <span class="token string">'true'</span>

<span class="token key atrule">mapper</span><span class="token punctuation">:</span>
    <span class="token comment"># 通用Mapper的insertSelective和updateByPrimaryKeySelective中是否判断字符串类型!=''</span>
    <span class="token key atrule">not-empty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">logging</span><span class="token punctuation">:</span>
    <span class="token comment"># Debug打印SQL</span>
    <span class="token key atrule">level.com.example.dao</span><span class="token punctuation">:</span> debug
</code></pre></div><h2 id="思路流程"><a href="#思路流程" class="header-anchor">#</a> 思路流程</h2> <p>一般的秒杀流程不外乎是这样的，这里先不考虑前端的处理</p> <ol><li>用户通过前端校验最终发起请求到<strong>Web</strong>层，对应的代码就是<strong>Controller</strong></li> <li>然后校验库存，扣库存，创建订单</li> <li>最终数据落地，持久化保存</li></ol> <h3 id="传统方式"><a href="#传统方式" class="header-anchor">#</a> 传统方式</h3> <p>我们首先搭建一个后台服务接口，不做任何限制，使用<strong>JMeter</strong>，模拟100个并发线程测试，可以发现<strong>并发事务下会出现错误</strong></p> <ol><li>读后写的更新丢失问题?</li> <li>数据库性能慢的问题</li></ol> <h3 id="使用乐观锁"><a href="#使用乐观锁" class="header-anchor">#</a> 使用乐观锁</h3> <h3 id="使用缓存"><a href="#使用缓存" class="header-anchor">#</a> 使用缓存</h3> <h3 id="使用分布式限流"><a href="#使用分布式限流" class="header-anchor">#</a> 使用分布式限流</h3> <h3 id="使用队列异步下单"><a href="#使用队列异步下单" class="header-anchor">#</a> 使用队列异步下单</h3> <h4 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h4> <ul><li>感谢杨冠标的流量削峰: <a href="https://www.cnblogs.com/yanggb/p/11117400.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/yanggb/p/11117400.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>感谢mikechen优知的高并发架构系列：什么是流量削峰？如何解决秒杀业务的削峰场景: <a href="https://www.jianshu.com/p/6746140bbb76" target="_blank" rel="noopener noreferrer">https://www.jianshu.com/p/6746140bbb76<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>感谢crossoverjie的SSM(十八) 秒杀架构实践: <a href="https://crossoverjie.top/2018/05/07/ssm/SSM18-seconds-kill/" target="_blank" rel="noopener noreferrer">https://crossoverjie.top/2018/05/07/ssm/SSM18-seconds-kill/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>感谢qiurunze123的秒杀系统设计与实现: <a href="https://github.com/qiurunze123/miaosha" target="_blank" rel="noopener noreferrer">https://github.com/qiurunze123/miaosha<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/dolyw/Note/edit/master/doc/seckill/README.md" target="_blank" rel="noopener noreferrer">在GitHub上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新时间:</span> <span class="time">2019-11-18 20:23:15</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/seckill/01-Tradition-Process.html">传统方式</a>
      →
    </span></p></div> </main></div><div class="global-ui"><div class="diy-loader center" style="display:none;" data-v-5de89142><div class="diy-loader-circle" data-v-5de89142></div></div><div class="my-popup" style="display:none;" data-v-3414bdeb><div class="my-popup-container" data-v-3414bdeb><div class="my-popup-exit" data-v-3414bdeb></div> <img src="" alt data-v-3414bdeb></div></div><!----><div></div></div></div>
    <script src="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/app.998d0eea.js" defer></script><script src="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/2.014606d6.js" defer></script><script src="https://cdn.jsdelivr.net/gh/wliduo/Note@master/docs/assets/js/52.ee610100.js" defer></script>
  </body>
</html>
